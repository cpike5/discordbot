<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Engagement Metrics - Discord Bot Admin</title>

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../../css/main.css">
  <link rel="stylesheet" href="analytics-shared.css">

  <!-- Tailwind CSS CDN with shared config -->
  <script src="../../css/tailwind.config.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = window.tailwindConfig;</script>

  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="bg-bg-primary text-text-primary font-sans antialiased">

  <!-- Main Content Area -->
  <main class="min-h-screen">
    <div class="p-4 lg:p-8 max-w-7xl mx-auto">

      <!-- Breadcrumb Navigation -->
      <nav aria-label="Breadcrumb" class="mb-6">
        <ol class="flex items-center gap-2 text-sm flex-wrap">
          <li>
            <a href="../../dashboard.html" class="text-text-secondary hover:text-accent-blue transition-colors">Dashboard</a>
          </li>
          <li class="text-text-tertiary" aria-hidden="true">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </li>
          <li>
            <a href="../../pages/servers-list.html" class="text-text-secondary hover:text-accent-blue transition-colors">Guilds</a>
          </li>
          <li class="text-text-tertiary" aria-hidden="true">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </li>
          <li>
            <a href="#" class="text-text-secondary hover:text-accent-blue transition-colors">Gaming Community</a>
          </li>
          <li class="text-text-tertiary" aria-hidden="true">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </li>
          <li>
            <span class="text-text-primary font-medium" aria-current="page">Engagement Metrics</span>
          </li>
        </ol>
      </nav>

      <!-- Page Header -->
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-lg">GC</div>
          <div>
            <h1 class="text-2xl lg:text-3xl font-bold text-text-primary">Engagement Metrics</h1>
            <p class="text-text-secondary">Gaming Community</p>
          </div>
        </div>

        <!-- Date Range Picker -->
        <div class="date-range-picker">
          <div class="date-preset-group">
            <button class="date-preset-btn" onclick="setDatePreset('today')">Today</button>
            <button class="date-preset-btn active" onclick="setDatePreset('7days')">7 Days</button>
            <button class="date-preset-btn" onclick="setDatePreset('30days')">30 Days</button>
            <button class="date-preset-btn" onclick="setDatePreset('custom')">Custom</button>
          </div>
          <div class="date-input-group hidden" id="customDateInputs">
            <input
              type="date"
              id="dateFrom"
              class="px-3 py-1.5 text-sm bg-bg-primary border border-border-primary rounded-md text-text-primary focus:border-border-focus focus:ring-1 focus:ring-border-focus transition-colors"
            />
            <span class="date-input-separator">to</span>
            <input
              type="date"
              id="dateTo"
              class="px-3 py-1.5 text-sm bg-bg-primary border border-border-primary rounded-md text-text-primary focus:border-border-focus focus:ring-1 focus:ring-border-focus transition-colors"
            />
          </div>
        </div>
      </div>

      <!-- Navigation Tabs -->
      <div class="analytics-tabs mb-6">
        <a href="server-analytics.html" class="analytics-tab">
          <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
          Overview
        </a>
        <a href="moderation-analytics.html" class="analytics-tab">
          <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          Moderation
        </a>
        <button class="analytics-tab active" onclick="switchTab('engagement')">
          <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          Engagement
        </button>
      </div>

      <!-- Summary Stats Cards -->
      <div class="stats-grid mb-8">
        <!-- Total Messages -->
        <div class="stat-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="stat-card-label">Total Messages</p>
              <p class="stat-card-value">8,492</p>
              <p class="stat-card-change positive">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                </svg>
                +12.4% vs last week
              </p>
            </div>
            <div class="stat-card-icon bg-accent-blue/10">
              <svg class="w-6 h-6 text-accent-blue" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
            </div>
          </div>
        </div>

        <!-- Messages/Day -->
        <div class="stat-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="stat-card-label">Messages/Day</p>
              <p class="stat-card-value">1,213</p>
              <p class="stat-card-change positive">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                </svg>
                +8.2% vs last week
              </p>
            </div>
            <div class="stat-card-icon bg-success/10">
              <svg class="w-6 h-6 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
              </svg>
            </div>
          </div>
        </div>

        <!-- Active Members -->
        <div class="stat-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="stat-card-label">Active Members</p>
              <p class="stat-card-value">342</p>
              <p class="stat-card-change neutral">27.7% of total</p>
            </div>
            <div class="stat-card-icon bg-accent-orange/10">
              <svg class="w-6 h-6 text-accent-orange" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </div>
          </div>
        </div>

        <!-- New Member Retention -->
        <div class="stat-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="stat-card-label">New Member Retention</p>
              <p class="stat-card-value">68%</p>
              <p class="stat-card-change positive">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                </svg>
                +5% vs last month
              </p>
            </div>
            <div class="stat-card-icon bg-info/10">
              <svg class="w-6 h-6 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Message Trends Chart (Full Width) -->
      <div class="chart-card mb-6">
        <div class="chart-card-header">
          <div>
            <h2 class="chart-card-title">Message Trends</h2>
            <p class="chart-card-subtitle">Messages and unique authors over time</p>
          </div>
        </div>
        <div class="chart-card-body">
          <div class="chart-container chart-container-lg">
            <canvas id="messageTrendsChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Channel Engagement Chart (Full Width) -->
      <div class="chart-card mb-6">
        <div class="chart-card-header">
          <div>
            <h2 class="chart-card-title">Channel Engagement</h2>
            <p class="chart-card-subtitle">Messages per channel with engagement rate</p>
          </div>
        </div>
        <div class="chart-card-body">
          <div class="chart-container chart-container-lg">
            <canvas id="channelEngagementChart"></canvas>
          </div>
        </div>
      </div>

      <!-- New Member Retention Funnel -->
      <div class="chart-card mb-6">
        <div class="chart-card-header">
          <div>
            <h2 class="chart-card-title">New Member Retention Funnel</h2>
            <p class="chart-card-subtitle">Tracking member engagement from join to active participation</p>
          </div>
          <span class="text-xs text-text-tertiary">Last 30 days</span>
        </div>
        <div class="chart-card-body">
          <div class="funnel-chart">
            <div class="funnel-step">
              <span class="funnel-step-name">Joined</span>
              <div class="funnel-bar" style="width: 100%;">
                <span class="funnel-bar-label">100%</span>
              </div>
              <span class="funnel-value">48 members</span>
            </div>
            <div class="funnel-step">
              <span class="funnel-step-name">Verified</span>
              <div class="funnel-bar" style="width: 87.5%; background-color: #0ba3ea;">
                <span class="funnel-bar-label">87.5%</span>
              </div>
              <span class="funnel-value">42 members</span>
            </div>
            <div class="funnel-step">
              <span class="funnel-step-name">First Message</span>
              <div class="funnel-bar" style="width: 75%; background-color: #10b981;">
                <span class="funnel-bar-label">75%</span>
              </div>
              <span class="funnel-value">36 members</span>
            </div>
            <div class="funnel-step">
              <span class="funnel-step-name">Week 1 Active</span>
              <div class="funnel-bar" style="width: 68.75%; background-color: #f59e0b;">
                <span class="funnel-bar-label">68.75%</span>
              </div>
              <span class="funnel-value">33 members</span>
            </div>
            <div class="funnel-step">
              <span class="funnel-step-name">Month 1 Active</span>
              <div class="funnel-bar" style="width: 56.25%; background-color: #cb4e1b;">
                <span class="funnel-bar-label">56.25%</span>
              </div>
              <span class="funnel-value">27 members</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Coming Soon Banner -->
      <div class="info-banner coming-soon mb-6">
        <svg class="info-banner-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <div class="info-banner-content">
          <p class="info-banner-title">Voice and Reaction Analytics Coming Soon</p>
          <p class="info-banner-text">We are working on bringing you detailed analytics for voice channel usage and message reactions. Stay tuned for updates!</p>
        </div>
      </div>

      <!-- Placeholder Cards for Coming Soon Features -->
      <div class="analytics-grid-2 mb-6">
        <!-- Voice Analytics Placeholder -->
        <div class="placeholder-card">
          <svg class="placeholder-card-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
          </svg>
          <p class="placeholder-card-title">Voice Channel Analytics</p>
          <p class="placeholder-card-text">Track voice activity, average session duration, and peak usage times</p>
        </div>

        <!-- Reaction Analytics Placeholder -->
        <div class="placeholder-card">
          <svg class="placeholder-card-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <p class="placeholder-card-title">Reaction Analytics</p>
          <p class="placeholder-card-text">Most used emojis, reaction rates, and sentiment analysis</p>
        </div>
      </div>

      <!-- Loading State Example Section -->
      <div class="chart-card mb-6">
        <div class="chart-card-header">
          <div>
            <h2 class="chart-card-title">Loading State Example</h2>
            <p class="chart-card-subtitle">Skeleton loading placeholders</p>
          </div>
        </div>
        <div class="chart-card-body">
          <!-- Skeleton Stats Grid -->
          <div class="stats-grid mb-6">
            <div class="stat-card">
              <div class="skeleton skeleton-text-sm mb-2" style="width: 60%;"></div>
              <div class="skeleton skeleton-stat-value"></div>
              <div class="skeleton skeleton-stat-change"></div>
            </div>
            <div class="stat-card">
              <div class="skeleton skeleton-text-sm mb-2" style="width: 50%;"></div>
              <div class="skeleton skeleton-stat-value"></div>
              <div class="skeleton skeleton-stat-change"></div>
            </div>
            <div class="stat-card">
              <div class="skeleton skeleton-text-sm mb-2" style="width: 70%;"></div>
              <div class="skeleton skeleton-stat-value"></div>
              <div class="skeleton skeleton-stat-change"></div>
            </div>
            <div class="stat-card">
              <div class="skeleton skeleton-text-sm mb-2" style="width: 55%;"></div>
              <div class="skeleton skeleton-stat-value"></div>
              <div class="skeleton skeleton-stat-change"></div>
            </div>
          </div>

          <!-- Skeleton Chart -->
          <div class="skeleton skeleton-chart"></div>
        </div>
      </div>

      <!-- Empty State Example Section -->
      <div class="chart-card">
        <div class="chart-card-header">
          <div>
            <h2 class="chart-card-title">Empty State Example</h2>
            <p class="chart-card-subtitle">When no data is available</p>
          </div>
        </div>
        <div class="chart-card-body">
          <div class="empty-state">
            <svg class="empty-state-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <h3 class="empty-state-title">No Engagement Data Available</h3>
            <p class="empty-state-description">
              There is no engagement data for the selected time period. Try selecting a different date range or wait for more activity.
            </p>
            <button class="mt-4 px-4 py-2 bg-accent-blue hover:bg-accent-blue-hover text-white font-medium text-sm rounded-lg transition-colors">
              Select Different Range
            </button>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- JavaScript -->
  <script>
    // Date Preset Handler
    function setDatePreset(preset) {
      document.querySelectorAll('.date-preset-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      const customInputs = document.getElementById('customDateInputs');
      if (preset === 'custom') {
        customInputs.classList.remove('hidden');
      } else {
        customInputs.classList.add('hidden');
      }
    }

    // Tab Switching
    function switchTab(tabName) {
      document.querySelectorAll('.analytics-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.closest('.analytics-tab').classList.add('active');
    }

    // Initialize Charts
    document.addEventListener('DOMContentLoaded', function() {
      // Chart.js default dark theme settings
      Chart.defaults.color = '#a8a5a3';
      Chart.defaults.borderColor = '#3f4447';

      // Message Trends Chart (Line with dual Y-axes)
      const trendsCtx = document.getElementById('messageTrendsChart').getContext('2d');
      new Chart(trendsCtx, {
        type: 'line',
        data: {
          labels: ['Dec 25', 'Dec 26', 'Dec 27', 'Dec 28', 'Dec 29', 'Dec 30', 'Dec 31'],
          datasets: [
            {
              label: 'Messages',
              data: [1089, 1247, 1156, 1423, 1312, 1089, 1176],
              borderColor: '#098ecf',
              backgroundColor: 'rgba(9, 142, 207, 0.1)',
              fill: true,
              tension: 0.4,
              yAxisID: 'y'
            },
            {
              label: 'Unique Authors',
              data: [156, 178, 167, 198, 185, 152, 168],
              borderColor: '#10b981',
              backgroundColor: 'transparent',
              borderDash: [5, 5],
              tension: 0.4,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                boxWidth: 12,
                padding: 20
              }
            },
            tooltip: {
              backgroundColor: '#2f3336',
              titleColor: '#d7d3d0',
              bodyColor: '#a8a5a3',
              borderColor: '#3f4447',
              borderWidth: 1,
              padding: 12
            }
          },
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              beginAtZero: false,
              grid: {
                color: '#2f3336'
              },
              title: {
                display: true,
                text: 'Messages',
                color: '#098ecf'
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              beginAtZero: false,
              grid: {
                drawOnChartArea: false
              },
              title: {
                display: true,
                text: 'Unique Authors',
                color: '#10b981'
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });

      // Channel Engagement Chart (Horizontal Bar)
      const channelCtx = document.getElementById('channelEngagementChart').getContext('2d');
      new Chart(channelCtx, {
        type: 'bar',
        data: {
          labels: ['#general', '#gaming', '#off-topic', '#memes', '#help', '#music', '#art', '#tech'],
          datasets: [
            {
              label: 'Messages',
              data: [2847, 2156, 1423, 1089, 756, 542, 389, 290],
              backgroundColor: '#098ecf',
              borderRadius: 4
            },
            {
              label: 'Avg Engagement Rate',
              data: [85, 78, 72, 95, 45, 62, 88, 52],
              backgroundColor: '#cb4e1b',
              borderRadius: 4
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                boxWidth: 12,
                padding: 20
              }
            },
            tooltip: {
              backgroundColor: '#2f3336',
              titleColor: '#d7d3d0',
              bodyColor: '#a8a5a3',
              borderColor: '#3f4447',
              borderWidth: 1,
              padding: 12,
              callbacks: {
                label: function(context) {
                  if (context.datasetIndex === 0) {
                    return context.parsed.x.toLocaleString() + ' messages';
                  } else {
                    return context.parsed.x + '% engagement';
                  }
                }
              }
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              grid: {
                color: '#2f3336'
              },
              ticks: {
                callback: function(value) {
                  return value.toLocaleString();
                }
              }
            },
            y: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    });
  </script>

</body>
</html>
