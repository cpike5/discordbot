@model DiscordBot.Bot.ViewModels.Components.PerformanceTabsViewModel
@{
    string GetTabClass(string tab) => Model.ActiveTab == tab ? "performance-tab active" : "performance-tab";
    // For AJAX navigation, add data-tab-id; for page navigation, use href
    string GetTabAttributes(string tabId, string href) => Model.UseAjaxNavigation
        ? $"data-tab-id=\"{tabId}\" href=\"#\""
        : $"href=\"{href}\"";

    // Icon paths - outline and solid versions
    var icons = new Dictionary<string, (string outline, string solid)>
    {
        ["overview"] = (
            "M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z",
            "M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zm6-4a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zm6-3a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
        ),
        ["health"] = (
            "M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z",
            "M3.172 5.172a4 4 0 015.656 0L12 8.343l3.172-3.171a4 4 0 115.656 5.656L12 19.657l-8.828-8.829a4 4 0 010-5.656z"
        ),
        ["commands"] = (
            "M13 10V3L4 14h7v7l9-11h-7z",
            "M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
        ),
        ["api"] = (
            "M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",
            "M14.447 3.027a.75.75 0 01.527.92l-4.5 16.5a.75.75 0 01-1.448-.394l4.5-16.5a.75.75 0 01.921-.526zM16.72 6.22a.75.75 0 011.06 0l5.25 5.25a.75.75 0 010 1.06l-5.25 5.25a.75.75 0 11-1.06-1.06L21.44 12l-4.72-4.72a.75.75 0 010-1.06zm-9.44 0a.75.75 0 010 1.06L2.56 12l4.72 4.72a.75.75 0 11-1.06 1.06L.97 12.53a.75.75 0 010-1.06l5.25-5.25a.75.75 0 011.06 0z"
        ),
        ["system"] = (
            "M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01",
            "M4.5 3A1.5 1.5 0 003 4.5v4A1.5 1.5 0 004.5 10h11a1.5 1.5 0 001.5-1.5v-4A1.5 1.5 0 0015.5 3h-11zm0 11A1.5 1.5 0 003 15.5v4A1.5 1.5 0 004.5 21h11a1.5 1.5 0 001.5-1.5v-4a1.5 1.5 0 00-1.5-1.5h-11zM13 7a1 1 0 100-2 1 1 0 000 2zm-3 0a1 1 0 100-2 1 1 0 000 2zm6 11a1 1 0 100-2 1 1 0 000 2zm-3 0a1 1 0 100-2 1 1 0 000 2z"
        ),
        ["alerts"] = (
            "M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9",
            "M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"
        )
    };
}

<div class="performance-tabs-container" id="performanceTabsContainer">
    <nav class="performance-tabs" id="performanceTabs" role="tablist" aria-label="Performance sections">
        <a @Html.Raw(GetTabAttributes("overview", "/Admin/Performance")) class="@GetTabClass("overview")" role="tab" aria-selected="@(Model.ActiveTab == "overview" ? "true" : "false")">
            @if (Model.ActiveTab == "overview")
            {
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="@icons["overview"].solid" />
                </svg>
            }
            else
            {
                <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="@icons["overview"].outline" />
                </svg>
            }
            <span>Overview</span>
        </a>
        <a @Html.Raw(GetTabAttributes("health", "/Admin/Performance/HealthMetrics")) class="@GetTabClass("health")" role="tab" aria-selected="@(Model.ActiveTab == "health" ? "true" : "false")">
            @if (Model.ActiveTab == "health")
            {
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="@icons["health"].solid" />
                </svg>
            }
            else
            {
                <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="@icons["health"].outline" />
                </svg>
            }
            <span class="tab-label-long">Health Metrics</span>
            <span class="tab-label-short">Health</span>
        </a>
        <a @Html.Raw(GetTabAttributes("commands", "/Admin/Performance/Commands")) class="@GetTabClass("commands")" role="tab" aria-selected="@(Model.ActiveTab == "commands" ? "true" : "false")">
            @if (Model.ActiveTab == "commands")
            {
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="@icons["commands"].solid" />
                </svg>
            }
            else
            {
                <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="@icons["commands"].outline" />
                </svg>
            }
            <span>Commands</span>
        </a>
        <a @Html.Raw(GetTabAttributes("api", "/Admin/Performance/ApiMetrics")) class="@GetTabClass("api")" role="tab" aria-selected="@(Model.ActiveTab == "api" ? "true" : "false")">
            @if (Model.ActiveTab == "api")
            {
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="@icons["api"].solid" />
                </svg>
            }
            else
            {
                <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="@icons["api"].outline" />
                </svg>
            }
            <span class="tab-label-long">API & Rate Limits</span>
            <span class="tab-label-short">API</span>
        </a>
        <a @Html.Raw(GetTabAttributes("system", "/Admin/Performance/SystemHealth")) class="@GetTabClass("system")" role="tab" aria-selected="@(Model.ActiveTab == "system" ? "true" : "false")">
            @if (Model.ActiveTab == "system")
            {
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="@icons["system"].solid" />
                </svg>
            }
            else
            {
                <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="@icons["system"].outline" />
                </svg>
            }
            <span>System</span>
        </a>
        <a @Html.Raw(GetTabAttributes("alerts", "/Admin/Performance/Alerts")) class="@GetTabClass("alerts")" role="tab" aria-selected="@(Model.ActiveTab == "alerts" ? "true" : "false")">
            @if (Model.ActiveTab == "alerts")
            {
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="@icons["alerts"].solid" />
                </svg>
            }
            else
            {
                <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="@icons["alerts"].outline" />
                </svg>
            }
            <span>Alerts</span>
            @if (Model.ActiveAlertCount > 0)
            {
                <span class="ml-1 px-1.5 py-0.5 text-xs font-bold bg-error/20 text-error rounded-full">@Model.ActiveAlertCount</span>
            }
        </a>
    </nav>
</div>

<script>
    (function() {
        const container = document.getElementById('performanceTabsContainer');
        const tabs = document.getElementById('performanceTabs');

        if (!container || !tabs) return;

        function updateScrollIndicators() {
            const scrollLeft = tabs.scrollLeft;
            const scrollWidth = tabs.scrollWidth;
            const clientWidth = tabs.clientWidth;

            // Check if content is scrollable
            const isScrollable = scrollWidth > clientWidth;

            if (isScrollable) {
                // Can scroll left if not at the start
                if (scrollLeft > 5) {
                    container.classList.add('can-scroll-left');
                } else {
                    container.classList.remove('can-scroll-left');
                }

                // Can scroll right if not at the end
                if (scrollLeft < scrollWidth - clientWidth - 5) {
                    container.classList.add('can-scroll-right');
                } else {
                    container.classList.remove('can-scroll-right');
                }
            } else {
                container.classList.remove('can-scroll-left', 'can-scroll-right');
            }
        }

        // Scroll active tab into view on load
        function scrollActiveTabIntoView() {
            const activeTab = tabs.querySelector('.performance-tab.active');
            if (activeTab) {
                const tabRect = activeTab.getBoundingClientRect();
                const containerRect = tabs.getBoundingClientRect();

                // Check if active tab is partially or fully outside view
                if (tabRect.left < containerRect.left || tabRect.right > containerRect.right) {
                    activeTab.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                }
            }
        }

        // Initial setup
        updateScrollIndicators();
        scrollActiveTabIntoView();

        // Update on scroll
        tabs.addEventListener('scroll', updateScrollIndicators, { passive: true });

        // Update on resize
        window.addEventListener('resize', updateScrollIndicators, { passive: true });
    })();
</script>
