@model DiscordBot.Bot.ViewModels.Components.FormSelectViewModel
@{
    var sizeClasses = Model.Size switch
    {
        DiscordBot.Bot.ViewModels.Components.InputSize.Small => "py-1.5 px-3 text-xs",
        DiscordBot.Bot.ViewModels.Components.InputSize.Large => "py-3 px-4 text-base",
        _ => "py-2.5 px-3.5 text-sm"
    };

    var validationClasses = Model.ValidationState switch
    {
        DiscordBot.Bot.ViewModels.Components.ValidationState.Error => "border-error focus:border-error focus:ring-error/15",
        DiscordBot.Bot.ViewModels.Components.ValidationState.Success => "border-success focus:border-success focus:ring-success/15",
        DiscordBot.Bot.ViewModels.Components.ValidationState.Warning => "border-warning focus:border-warning focus:ring-warning/15",
        _ => "border-border-primary focus:border-accent-blue focus:ring-accent-blue/15"
    };

    var selectClasses = $"w-full {sizeClasses} pr-10 text-text-primary bg-bg-primary border {validationClasses} rounded-md appearance-none transition-colors focus:outline-none focus:ring-[3px]";

    if (Model.IsDisabled)
    {
        selectClasses += " bg-bg-secondary text-text-tertiary cursor-not-allowed opacity-60";
    }
}

<div class="space-y-1.5">
    @if (!string.IsNullOrEmpty(Model.Label))
    {
        <label for="@Model.Id" class="block text-sm font-medium text-text-primary">
            @Model.Label
            @if (Model.IsRequired)
            {
                <span class="text-error">*</span>
            }
        </label>
    }

    <div class="relative">
        <select
            id="@Model.Id"
            name="@Model.Name"
            class="@selectClasses"
            @if (Model.IsRequired)
            {
                @:required
            }
            @if (Model.IsDisabled)
            {
                @:disabled
            }
            @if (Model.AllowMultiple)
            {
                @:multiple
            }
            @if (Model.AdditionalAttributes != null)
            {
                foreach (var attr in Model.AdditionalAttributes)
                {
                    @($"{attr.Key}=\"{attr.Value}\"")
                }
            }
        >
            @if (!string.IsNullOrEmpty(Model.Placeholder) && !Model.AllowMultiple)
            {
                var placeholderSelected = string.IsNullOrEmpty(Model.SelectedValue);
                if (placeholderSelected)
                {
                    <option value="" disabled selected>@Model.Placeholder</option>
                }
                else
                {
                    <option value="" disabled>@Model.Placeholder</option>
                }
            }

            @if (Model.OptionGroups != null && Model.OptionGroups.Any())
            {
                foreach (var group in Model.OptionGroups)
                {
                    <optgroup label="@group.Label">
                        @foreach (var option in group.Options)
                        {
                            var isSelected = option.Value == Model.SelectedValue;
                            if (isSelected)
                            {
                                if (option.IsDisabled)
                                {
                                    <option value="@option.Value" selected disabled>@option.Text</option>
                                }
                                else
                                {
                                    <option value="@option.Value" selected>@option.Text</option>
                                }
                            }
                            else
                            {
                                if (option.IsDisabled)
                                {
                                    <option value="@option.Value" disabled>@option.Text</option>
                                }
                                else
                                {
                                    <option value="@option.Value">@option.Text</option>
                                }
                            }
                        }
                    </optgroup>
                }
            }
            else
            {
                foreach (var option in Model.Options)
                {
                    var isSelected = option.Value == Model.SelectedValue;
                    if (isSelected)
                    {
                        if (option.IsDisabled)
                        {
                            <option value="@option.Value" selected disabled>@option.Text</option>
                        }
                        else
                        {
                            <option value="@option.Value" selected>@option.Text</option>
                        }
                    }
                    else
                    {
                        if (option.IsDisabled)
                        {
                            <option value="@option.Value" disabled>@option.Text</option>
                        }
                        else
                        {
                            <option value="@option.Value">@option.Text</option>
                        }
                    }
                }
            }
        </select>

        <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
            <svg class="w-5 h-5 text-text-tertiary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.HelpText) && Model.ValidationState == DiscordBot.Bot.ViewModels.Components.ValidationState.None)
    {
        <p class="text-xs text-text-secondary">@Model.HelpText</p>
    }

    @if (Model.ValidationState == DiscordBot.Bot.ViewModels.Components.ValidationState.Error && !string.IsNullOrEmpty(Model.ValidationMessage))
    {
        <p class="flex items-center gap-1.5 text-xs text-error">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            @Model.ValidationMessage
        </p>
    }

    @if (Model.ValidationState == DiscordBot.Bot.ViewModels.Components.ValidationState.Success && !string.IsNullOrEmpty(Model.ValidationMessage))
    {
        <p class="flex items-center gap-1.5 text-xs text-success">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            @Model.ValidationMessage
        </p>
    }

    @if (Model.ValidationState == DiscordBot.Bot.ViewModels.Components.ValidationState.Warning && !string.IsNullOrEmpty(Model.ValidationMessage))
    {
        <p class="flex items-center gap-1.5 text-xs text-warning">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            @Model.ValidationMessage
        </p>
    }
</div>
