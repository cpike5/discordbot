@model DiscordBot.Bot.ViewModels.Components.TypedConfirmationModalViewModel
@using DiscordBot.Bot.ViewModels.Components

<!-- Typed Confirmation Modal -->
<div id="@Model.Id" class="hidden fixed inset-0 z-50" role="alertdialog" aria-modal="true" aria-labelledby="@(Model.Id)Title" aria-describedby="@(Model.Id)Desc">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black/70 backdrop-blur-sm" onclick="window.settingsManager?.hideTypedModal('@Model.Id')"></div>

    <!-- Modal Dialog -->
    <div class="fixed inset-0 flex items-center justify-center p-4">
        <div class="bg-bg-tertiary border border-border-primary rounded-lg shadow-xl max-w-md w-full" role="document">
            <!-- Modal Content -->
            <div class="p-6">
                <div class="flex items-start gap-4">
                    <!-- Icon -->
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-@GetVariantColorClass(Model.Variant)/20 flex items-center justify-center">
                        <svg class="w-5 h-5 text-@GetVariantColorClass(Model.Variant)" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="@GetDefaultIconPath(Model.Variant)" />
                        </svg>
                    </div>

                    <!-- Text Content -->
                    <div class="flex-1">
                        <h3 id="@(Model.Id)Title" class="text-lg font-semibold text-text-primary">@Model.Title</h3>
                        <p id="@(Model.Id)Desc" class="mt-2 text-sm text-text-secondary">@Model.Message</p>

                        <!-- Typed Input -->
                        <div class="mt-4">
                            <label for="@(Model.Id)Input" class="block text-sm font-medium text-text-primary mb-2">
                                @Model.InputLabel
                            </label>
                            <input
                                type="text"
                                id="@(Model.Id)Input"
                                class="w-full px-3 py-2 text-sm bg-bg-primary border border-error rounded-md text-text-primary placeholder-text-tertiary focus:border-error focus:ring-1 focus:ring-error transition-colors"
                                placeholder="@Model.RequiredText"
                                autocomplete="off"
                                data-required-text="@Model.RequiredText"
                                data-confirm-btn="@(Model.Id)ConfirmBtn"
                                oninput="window.settingsManager?.validateTypedInput(this)"
                            />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 px-6 py-4 bg-bg-secondary border-t border-border-primary rounded-b-lg">
                <button type="button"
                        onclick="window.settingsManager?.hideTypedModal('@Model.Id')"
                        class="px-4 py-2 bg-bg-tertiary hover:bg-bg-hover border border-border-primary text-text-primary font-medium text-sm rounded-md transition-colors">
                    @Model.CancelText
                </button>

                <form method="post" action="@Model.FormAction" class="inline-block" id="@(Model.Id)Form">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="handler" value="@Model.FormHandler" />
                    <button type="submit"
                            id="@(Model.Id)ConfirmBtn"
                            disabled
                            class="px-4 py-2 @GetConfirmButtonClass(Model.Variant) text-white font-medium text-sm rounded-md transition-colors min-w-[100px] flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="confirm-btn-text">@Model.ConfirmText</span>
                        <svg class="hidden w-4 h-4 animate-spin confirm-btn-spinner" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetVariantColorClass(ConfirmationVariant variant)
    {
        return variant switch
        {
            ConfirmationVariant.Info => "accent-blue",
            ConfirmationVariant.Warning => "warning",
            ConfirmationVariant.Danger => "error",
            _ => "warning"
        };
    }

    private string GetConfirmButtonClass(ConfirmationVariant variant)
    {
        return variant switch
        {
            ConfirmationVariant.Info => "bg-accent-blue hover:bg-accent-blue-hover active:bg-accent-blue-active disabled:hover:bg-accent-blue",
            ConfirmationVariant.Warning => "bg-warning hover:bg-amber-600 active:bg-amber-700 disabled:hover:bg-warning",
            ConfirmationVariant.Danger => "bg-error hover:bg-red-600 active:bg-red-700 disabled:hover:bg-error",
            _ => "bg-accent-orange hover:bg-accent-orange-hover active:bg-accent-orange-active disabled:hover:bg-accent-orange"
        };
    }

    private string GetDefaultIconPath(ConfirmationVariant variant)
    {
        return variant switch
        {
            ConfirmationVariant.Info => "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
            ConfirmationVariant.Danger => "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",
            _ => "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
        };
    }
}
