@inject DiscordBot.Core.Interfaces.IThemeService ThemeService
<!DOCTYPE html>
<html lang="en" data-theme="@(await ThemeService.GetCurrentThemeKeyAsync())">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Discord Bot Admin</title>
    <!-- Blocking theme application script - runs before first paint to prevent flash -->
    <script>
        (function() {
            try {
                var match = document.cookie.match(/theme-preference=([^;]+)/);
                var theme = match ? decodeURIComponent(match[1]) : localStorage.getItem('theme-preference');
                if (theme) document.documentElement.setAttribute('data-theme', theme);
            } catch (e) {}
        })();
    </script>
    <!-- Compiled Tailwind CSS (built from site.css via npm run build:css) -->
    <link rel="stylesheet" href="~/css/app.css" asp-append-version="true" />
    @await RenderSectionAsync("Styles", required: false)
    <!-- Early sidebar state restoration to prevent FOUC (Flash of Unstyled Content) -->
    <script>
        (function() {
            try {
                if (localStorage.getItem('sidebarCollapsed') === 'true' && window.innerWidth >= 1024) {
                    document.documentElement.classList.add('sidebar-collapsed');
                }
            } catch (e) {}
        })();
    </script>
</head>
<body class="bg-bg-primary text-text-primary font-sans antialiased">

    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Mobile Sidebar Overlay -->
    <div id="mobileOverlay" class="mobile-overlay lg:hidden" onclick="toggleMobileSidebar()"></div>
    <!-- Mobile Search Overlay -->
    @await Html.PartialAsync("_MobileSearchOverlay")


    <!-- Top Navigation Bar -->
    @await Html.PartialAsync("_Navbar")

    <!-- Sidebar Navigation -->
    @await Html.PartialAsync("_Sidebar")

    <!-- Main Content Area -->
    <main id="main-content" class="main-content-redesign">
        <div class="p-6 lg:p-8">
            <!-- Breadcrumb Navigation -->
            @await Html.PartialAsync("_Breadcrumb")

            <!-- Page Content -->
            @RenderBody()
        </div>
    </main>

    <!-- Page Loading Overlay -->
    @await Html.PartialAsync("Components/_PageLoadingOverlay", new DiscordBot.Bot.ViewModels.Components.PageLoadingOverlayViewModel())

    <!-- Toast Notifications Container -->
    @await Html.PartialAsync("_ToastContainer")

    <!-- SignalR Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <!-- Dashboard Hub Connection Manager -->
    <script src="~/js/dashboard-hub.js" asp-append-version="true"></script>
    <!-- Notification Bell Module -->
    <script src="~/js/notification-bell.js" asp-append-version="true"></script>
    <!-- JavaScript for Navigation -->
    <script src="~/js/navigation.js" asp-append-version="true"></script>
    <!-- JavaScript for Toast Notifications -->
    <script src="~/js/toast.js" asp-append-version="true"></script>
    <!-- JavaScript for Loading State Management -->
    <script src="~/js/loading-manager.js" asp-append-version="true"></script>
    <!-- Timezone Utilities -->
    <script src="~/js/timezone.js" asp-append-version="true"></script>
    <!-- Bot Status Auto-Refresh -->
    <script src="~/js/bot-status-refresh.js" asp-append-version="true"></script>
    <!-- Search Keyboard Shortcuts -->
    <script src="~/js/search.js" asp-append-version="true"></script>
    <!-- Preview Popup Module -->
    <script src="~/js/preview-popup.js" asp-append-version="true"></script>
    <!-- Theme Manager Module -->
    <script src="~/js/theme.js" asp-append-version="true"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
