@model DiscordBot.Core.DTOs.SettingDto
@using DiscordBot.Core.Enums
@using DiscordBot.Bot.ViewModels.Components

@{
    var inputId = $"setting_{Model.Key.Replace(":", "_").Replace(".", "_")}";
    var inputName = $"FormSettings[{Model.Key}]";
}

@if (Model.DataType == SettingDataType.Boolean)
{
    <!-- Boolean Toggle -->
    <div class="lg:col-span-2">
        <div class="flex items-start gap-4 p-4 bg-bg-primary rounded-lg border border-border-primary">
            @{
                var toggleViewModel = new FormToggleViewModel
                {
                    Id = inputId,
                    Name = inputName,
                    Label = Model.DisplayName,
                    Description = Model.Description,
                    IsChecked = Model.Value?.ToLower() == "true",
                    IsDisabled = false
                };
            }
            <partial name="Components/_FormToggle" model="toggleViewModel" />
            @if (Model.RequiresRestart)
            {
                <div class="ml-auto flex-shrink-0">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-warning/10 border border-warning text-warning text-xs font-medium rounded">
                        <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Restart Required
                    </span>
                </div>
            }
        </div>
    </div>
}
else if (Model.AllowedValues != null && Model.AllowedValues.Any())
{
    <!-- Dropdown Select -->
    <div>
        @{
            var selectViewModel = new FormSelectViewModel
            {
                Id = inputId,
                Name = inputName,
                Label = Model.DisplayName,
                SelectedValue = Model.Value,
                Options = Model.AllowedValues.Select(v => new SelectOption { Value = v, Text = v }).ToList(),
                HelpText = Model.Description,
                IsRequired = false
            };
        }
        <partial name="Components/_FormSelect" model="selectViewModel" />
        @if (Model.RequiresRestart)
        {
            <span class="inline-flex items-center gap-1 px-2 py-1 mt-2 bg-warning/10 border border-warning text-warning text-xs font-medium rounded">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Restart Required
            </span>
        }
    </div>
}
else if (Model.DataType == SettingDataType.Integer || Model.DataType == SettingDataType.Decimal)
{
    <!-- Number Input -->
    <div>
        @{
            var inputType = Model.DataType == SettingDataType.Decimal ? "number" : "number";
            var step = Model.DataType == SettingDataType.Decimal ? "0.01" : "1";

            var inputViewModel = new FormInputViewModel
            {
                Id = inputId,
                Name = inputName,
                Label = Model.DisplayName,
                Type = inputType,
                Value = Model.Value,
                HelpText = Model.Description,
                IsRequired = false,
                AdditionalAttributes = new Dictionary<string, string> { { "step", step } }
            };
        }
        <partial name="Components/_FormInput" model="inputViewModel" />
        @if (Model.RequiresRestart)
        {
            <span class="inline-flex items-center gap-1 px-2 py-1 mt-2 bg-warning/10 border border-warning text-warning text-xs font-medium rounded">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Restart Required
            </span>
        }
    </div>
}
else
{
    <!-- Text Input (String, Json, etc.) -->
    <div>
        @{
            var inputViewModel = new FormInputViewModel
            {
                Id = inputId,
                Name = inputName,
                Label = Model.DisplayName,
                Type = "text",
                Value = Model.Value,
                HelpText = Model.Description,
                IsRequired = false
            };
        }
        <partial name="Components/_FormInput" model="inputViewModel" />
        @if (Model.RequiresRestart)
        {
            <span class="inline-flex items-center gap-1 px-2 py-1 mt-2 bg-warning/10 border border-warning text-warning text-xs font-medium rounded">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Restart Required
            </span>
        }
    </div>
}
