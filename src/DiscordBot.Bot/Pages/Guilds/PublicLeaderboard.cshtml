@page "{guildId:long}/Leaderboard"
@model DiscordBot.Bot.Pages.Guilds.PublicLeaderboardModel
@using DiscordBot.Bot.ViewModels.Components
@{
    ViewData["Title"] = $"Hall of Shame - {Model.GuildName}";
    Layout = null; // Public page - no sidebar/navbar
}

@functions {
    string GetRelativeTime(DateTime utcDate)
    {
        var daysAgo = (DateTime.UtcNow - utcDate).Days;
        if (daysAgo == 0) return "Today";
        if (daysAgo == 1) return "Yesterday";
        if (daysAgo < 7) return $"{daysAgo} days ago";
        if (daysAgo < 30) return $"{daysAgo / 7} week{(daysAgo / 7 != 1 ? "s" : "")} ago";
        return utcDate.ToString("MMM d, yyyy");
    }
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>

    <!-- Open Graph meta tags for social sharing -->
    <meta property="og:title" content="@ViewData["Title"]" />
    <meta property="og:description" content="View the Hall of Shame leaderboard for @Model.GuildName - accountability metrics and fun stats!" />
    <meta property="og:type" content="website" />
    @if (!string.IsNullOrEmpty(Model.GuildIconUrl))
    {
        <meta property="og:image" content="@Model.GuildIconUrl" />
    }

    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="@ViewData["Title"]" />
    <meta name="twitter:description" content="View the Hall of Shame leaderboard for @Model.GuildName" />

    <!-- Compiled Tailwind CSS -->
    <link rel="stylesheet" href="~/css/app.css" asp-append-version="true" />

    <style>
        /* Public page styling - dark Discord aesthetic */
        body {
            background: linear-gradient(135deg, #1d2022 0%, #262a2d 100%);
            min-height: 100vh;
        }

        .rat-emoji {
            font-size: 2rem;
            animation: wiggle 2s ease-in-out infinite;
        }

        @@keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        .rank-medal {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
        }

        .rank-1 {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1d2022;
        }

        .rank-2 {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            color: #1d2022;
        }

        .rank-3 {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #1d2022;
        }

        .footer-link {
            color: #a8a5a3;
            text-decoration: none;
            transition: color 0.2s ease-in-out;
        }

        .footer-link:hover {
            color: #d7d3d0;
        }
    </style>
</head>
<body class="font-sans antialiased text-text-primary">

    @if (!Model.IsLeaderboardPublic)
    {
        <!-- Not Public Message -->
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="max-w-md w-full bg-bg-secondary border border-border-primary rounded-xl p-8 text-center">
                <div class="mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-warning/10 mb-4">
                        <svg class="w-8 h-8 text-warning" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-text-primary mb-2">Private Leaderboard</h1>
                    <p class="text-text-secondary">This leaderboard is not publicly accessible.</p>
                    <p class="text-sm text-text-tertiary mt-4">Server administrators can enable public access in Rat Watch settings.</p>
                </div>
                <div class="pt-6 border-t border-border-primary">
                    <p class="text-xs text-text-tertiary">Powered by @Model.AppTitle</p>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Public Leaderboard Content -->
        <div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-5xl mx-auto">

                <!-- Header -->
                <div class="text-center mb-12">
                    <div class="flex items-center justify-center gap-3 mb-4">
                        @if (!string.IsNullOrEmpty(Model.GuildIconUrl))
                        {
                            <img src="@Model.GuildIconUrl" alt="@Model.GuildName icon" class="w-16 h-16 rounded-full" />
                        }
                        <span class="rat-emoji">üêÄ</span>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold text-text-primary mb-2">Hall of Shame</h1>
                    <p class="text-xl text-text-secondary">@Model.GuildName</p>
                    <p class="text-sm text-text-tertiary mt-2">Accountability metrics and fun stats</p>
                </div>

                <!-- Fun Stats Highlight Cards -->
                @if (Model.FunStats != null)
                {
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-12">
                        @if (Model.FunStats.LongestGuiltyStreak != null)
                        {
                            <div class="bg-bg-secondary border border-border-primary rounded-lg p-6 text-center">
                                <div class="text-3xl mb-2">üî•</div>
                                <h3 class="text-sm font-semibold text-text-secondary uppercase tracking-wider mb-1">Longest Guilty Streak</h3>
                                <p class="text-2xl font-bold text-error">@Model.FunStats.LongestGuiltyStreak.StreakCount</p>
                                <p class="text-sm text-text-tertiary mt-1">@Model.FunStats.LongestGuiltyStreak.Username</p>
                            </div>
                        }

                        @if (Model.FunStats.BiggestLandslide != null)
                        {
                            <div class="bg-bg-secondary border border-border-primary rounded-lg p-6 text-center">
                                <div class="text-3xl mb-2">‚ö°</div>
                                <h3 class="text-sm font-semibold text-text-secondary uppercase tracking-wider mb-1">Biggest Landslide</h3>
                                <p class="text-2xl font-bold text-warning">@Model.FunStats.BiggestLandslide.Description</p>
                                <p class="text-sm text-text-tertiary mt-1">@Model.FunStats.BiggestLandslide.Username</p>
                            </div>
                        }

                        @if (Model.FunStats.FastestCheckIn != null)
                        {
                            <div class="bg-bg-secondary border border-border-primary rounded-lg p-6 text-center">
                                <div class="text-3xl mb-2">‚ö°</div>
                                <h3 class="text-sm font-semibold text-text-secondary uppercase tracking-wider mb-1">Speed Demon</h3>
                                <p class="text-2xl font-bold text-success">@Model.FunStats.FastestCheckIn.Description</p>
                                <p class="text-sm text-text-tertiary mt-1">@Model.FunStats.FastestCheckIn.Username</p>
                            </div>
                        }
                    </div>
                }

                <!-- Leaderboard Table -->
                <div class="bg-bg-secondary border border-border-primary rounded-xl overflow-hidden mb-8">
                    <div class="px-6 py-4 border-b border-border-primary bg-bg-tertiary">
                        <h2 class="text-xl font-bold text-text-primary flex items-center gap-2">
                            <span>üèÜ</span>
                            <span>Top 25 Rats</span>
                        </h2>
                        <p class="text-sm text-text-secondary mt-1">Users with the most guilty verdicts</p>
                    </div>

                    @if (Model.Leaderboard.Any())
                    {
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-bg-primary/50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider">Rank</th>
                                        <th class="px-6 py-3 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider">User</th>
                                        <th class="px-6 py-3 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider">Rat Count</th>
                                        <th class="px-6 py-3 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider">Last Incident</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-border-primary">
                                    @foreach (var entry in Model.Leaderboard)
                                    {
                                        <tr class="hover:bg-bg-hover transition-colors">
                                            <td class="px-6 py-4">
                                                @if (entry.Rank <= 3)
                                                {
                                                    <div class="rank-medal rank-@entry.Rank" role="img" aria-label="Rank @entry.Rank">@entry.Rank</div>
                                                }
                                                else
                                                {
                                                    <span class="text-text-secondary font-medium">#@entry.Rank</span>
                                                }
                                            </td>
                                            <td class="px-6 py-4">
                                                <p class="font-medium text-text-primary">@entry.Username</p>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span class="inline-flex items-center px-3 py-1 text-sm font-semibold text-error bg-error/10 rounded-full">
                                                    üêÄ @entry.RatCount
                                                </span>
                                            </td>
                                            <td class="px-6 py-4">
                                                @if (entry.LastIncidentDate.HasValue)
                                                {
                                                    <span class="text-sm text-text-secondary">@GetRelativeTime(entry.LastIncidentDate.Value)</span>
                                                }
                                                else
                                                {
                                                    <span class="text-sm text-text-tertiary">-</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="py-12 text-center">
                            <p class="text-text-secondary font-medium">No guilty verdicts yet</p>
                            <p class="text-sm text-text-tertiary mt-1">The Hall of Shame is currently empty</p>
                        </div>
                    }
                </div>

                <!-- Recent Incidents -->
                @if (Model.RecentIncidents.Any())
                {
                    <div class="bg-bg-secondary border border-border-primary rounded-xl overflow-hidden mb-8">
                        <div class="px-6 py-4 border-b border-border-primary bg-bg-tertiary">
                            <h2 class="text-xl font-bold text-text-primary flex items-center gap-2">
                                <span>üìã</span>
                                <span>Recent Incidents</span>
                            </h2>
                            <p class="text-sm text-text-secondary mt-1">Last 10 guilty verdicts</p>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-bg-primary/50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider">User</th>
                                        <th class="px-6 py-3 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider">Outcome</th>
                                        <th class="px-6 py-3 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider">Vote Tally</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-border-primary">
                                    @foreach (var incident in Model.RecentIncidents)
                                    {
                                        <tr class="hover:bg-bg-hover transition-colors">
                                            <td class="px-6 py-4">
                                                <span class="text-sm text-text-secondary">@GetRelativeTime(incident.Date)</span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <p class="font-medium text-text-primary">@incident.Username</p>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span class="inline-flex items-center px-2.5 py-0.5 text-xs font-semibold text-error bg-error/10 rounded-full">
                                                    @incident.Outcome
                                                </span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span class="text-sm text-text-secondary font-mono">@incident.VoteTally</span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }

                <!-- Footer -->
                <div class="text-center py-8 border-t border-border-primary">
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <p class="text-sm mb-3">
                            <a asp-page="/Guilds/RatWatch/Index" asp-route-guildId="@Model.GuildId"
                               class="inline-flex items-center gap-1.5 footer-link font-medium hover:text-text-primary transition-colors">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                                </svg>
                                Back to Rat Watch Settings
                            </a>
                        </p>
                    }
                    <p class="text-sm text-text-tertiary mb-2">
                        Powered by <a href="/" class="footer-link font-medium">@Model.AppTitle</a>
                    </p>
                    <p class="text-xs text-text-tertiary">
                        Accountability metrics updated in real-time ‚Ä¢ Privacy-focused design
                    </p>
                </div>

            </div>
        </div>
    }

</body>
</html>
