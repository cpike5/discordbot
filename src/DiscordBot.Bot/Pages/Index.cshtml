@page
@model DiscordBot.Bot.Pages.IndexModel
@using DiscordBot.Bot.ViewModels.Components
@{
    ViewData["Title"] = "Dashboard";
}

<!-- Page Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
    <div>
        <h1 class="text-2xl lg:text-3xl font-bold text-text-primary">Dashboard</h1>
        <p class="mt-1 text-text-secondary">Welcome back! Here's an overview of your bot's performance.</p>
    </div>
    <div>
        <partial name="Shared/Components/_ConnectionStatus" model="@(new DiscordBot.Bot.ViewModels.Components.ConnectionStatusViewModel())" />
    </div>
</div>

<!-- Quick Actions Section -->
<div class="mb-8">
    <partial name="Shared/Components/_QuickActionsCard" model="Model.QuickActions" />
</div>

<!-- Stats Cards Row -->
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 lg:gap-6 mb-8">
    <!-- Bot Status Card -->
    <partial name="Shared/Components/_BotStatusCard" model="Model.BotStatus" />

    <!-- Guild Statistics Card -->
    <partial name="Shared/Components/_GuildStatsCard" model="Model.GuildStats" />
</div>

<!-- Command Usage Statistics Section -->
<div class="mb-8">
    <partial name="Shared/Components/_CommandStatsCard" model="Model.CommandStats" />
</div>

<!-- Recent Activity Section -->
<div class="mb-8">
    <partial name="Shared/Components/_RecentActivityCard" model="Model.RecentActivity" />
</div>

<!-- Audit Log Section (Admin only) -->
@if (Model.AuditLog != null && (User.IsInRole("Admin") || User.IsInRole("SuperAdmin")))
{
    <div class="mb-8">
        <partial name="Shared/Components/_AuditLogCard" model="Model.AuditLog" />
    </div>
}

<!-- Live Activity Feed Section -->
<div class="mb-8">
    <partial name="Shared/Components/_ActivityFeed" model="@(new DiscordBot.Bot.ViewModels.Components.ActivityFeedViewModel())" />
</div>

<!-- Confirmation Modals (hidden by default) -->
@{
    var restartBotModal = new ConfirmationModalViewModel
    {
        Id = "restartBotModal",
        Title = "Restart Bot",
        Message = "Are you sure you want to restart the bot? This will disconnect the bot from all servers temporarily. The bot will automatically reconnect after restarting.",
        ConfirmText = "Restart Bot",
        CancelText = "Cancel",
        Variant = ConfirmationVariant.Warning,
        FormAction = "",
        FormHandler = "RestartBot"
    };
}
<partial name="Shared/Components/_ConfirmationModal" model="restartBotModal" />

<!-- Toast Container -->
<partial name="Shared/Components/_ToastContainer" />

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="~/js/dashboard-hub.js" asp-append-version="true"></script>
    <script src="~/js/dashboard-realtime.js" asp-append-version="true"></script>
    <script src="~/js/command-stats-chart.js" asp-append-version="true"></script>
    <script src="~/js/quick-actions.js" asp-append-version="true"></script>
}
