@page
@model DiscordBot.Bot.Pages.IndexModel
@using DiscordBot.Bot.ViewModels.Components
@{
    ViewData["Title"] = "Dashboard";
}

<!-- Page Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
    <div>
        <h1 class="text-2xl lg:text-3xl font-bold text-text-primary">Dashboard</h1>
        <p class="mt-1 text-text-secondary">Welcome back! Here's an overview of your bot's performance.</p>
    </div>
</div>

<!-- Bot Status Banner -->
<div class="mb-8">
    <partial name="Shared/Components/_BotStatusBanner" model="Model.BotStatusBanner" />
</div>

<!-- Hero Metrics Grid (4 columns) -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8">
    @foreach (var metric in Model.HeroMetrics)
    {
        <partial name="Shared/Components/_HeroMetricCard" model="metric" />
    }
</div>

<!-- Connected Servers and Activity Timeline - 3 Column Grid -->
<div class="grid grid-cols-1 xl:grid-cols-3 gap-4 lg:gap-6 mb-8">
    <!-- Connected Servers Widget (2/3 width) -->
    <partial name="Shared/Components/_ConnectedServersWidget" model="Model.ConnectedServers" />

    <!-- Activity Timeline (1/3 width) -->
    <div class="xl:col-span-1 flex flex-col">
        <partial name="Shared/Components/_ActivityFeedTimeline" model="Model.ActivityTimeline" />
    </div>
</div>

<!-- Audit Log - Full Width (Admin only) -->
@if (Model.AuditLog != null && (User.IsInRole("Admin") || User.IsInRole("SuperAdmin")))
{
    <div class="mb-8">
        <partial name="Shared/Components/_AuditLogCard" model="Model.AuditLog" />
    </div>
}

<!-- Quick Actions Panel at Bottom -->
<div class="mb-8">
    <partial name="Shared/Components/_QuickActionsCard" model="Model.QuickActions" />
</div>

<!-- Confirmation Modals (hidden by default) -->
@{
    var restartBotModal = new ConfirmationModalViewModel
    {
        Id = "restartBotModal",
        Title = "Restart Bot",
        Message = "Are you sure you want to restart the bot? This will disconnect the bot from all servers temporarily. The bot will automatically reconnect after restarting.",
        ConfirmText = "Restart Bot",
        CancelText = "Cancel",
        Variant = ConfirmationVariant.Warning,
        FormAction = "",
        FormHandler = "RestartBot"
    };
}
<partial name="Shared/Components/_ConfirmationModal" model="restartBotModal" />

<!-- Toast Container -->
<partial name="Shared/Components/_ToastContainer" />

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="~/js/dashboard-hub.js" asp-append-version="true"></script>
    <script src="~/js/dashboard-realtime.js" asp-append-version="true"></script>
    <script src="~/js/command-stats-chart.js" asp-append-version="true"></script>
    <script src="~/js/quick-actions.js" asp-append-version="true"></script>
}
